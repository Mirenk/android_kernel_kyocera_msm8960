/* Copyright (c) 2011, Code Aurora Forum. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
 * 02110-1301, USA.
 */
/*
 * This software is contributed or developed by KYOCERA Corporation.
 * (C) 2012 KYOCERA Corporation
 */

#include "msm_sensor.h"
#include "msm.h"
#include "msm_ispif.h"
#include <linux/mfd/pm8xxx/pm8921.h>
#include <linux/i2c.h>
#include <linux/i2c/sx150x.h>
#include <linux/gpio.h>
#include <linux/types.h>
#include <mach/irqs.h>
#include <mach/rpm-regulator.h>
#include <mach/msm_memtypes.h>
#include "msm_camera_i2c_mux.h"



#include <linux/kernel.h>
#if 0
#define KC_CAM_CDBG(fmt, ...) \
printk("[KC_CAM]%s(%d): " fmt, __func__, __LINE__, ## __VA_ARGS__)
#else
#define KC_CAM_CDBG(fmt, ...)
#endif

#define SENSOR_NAME "mt9d113"
#define PLATFORM_DRIVER_NAME "msm_camera_mt9d113"
#define mt9d113_obj mt9d113_##obj

#define MT9D113_EXPOSURE_SETTING_SIZE 10

#define MT9D113_EXPOSURE_VALUE_STEP 1
#define MT9D113_EXPOSURE_VALUE_MAX 6
#define MT9D113_EXPOSURE_TBL_SIZE (((MT9D113_EXPOSURE_VALUE_MAX) * 2) + 1)

#define MT9D113_WB_AUTO            0
#define MT9D113_WB_DAYLIGHT        1
#define MT9D113_WB_FLUORESCENT     2
#define MT9D113_WB_CLOUDY_DAYLIGHT 3
#define MT9D113_WB_INCANDESCENT    4
#define MT9D113_WB_MAX             5
#define MT9D113_WB_NONE         0xff
#define MT9D113_WB_SETTING_SIZE 12

#define MT9D113_SCENE_TBL_SIZE 2
#define MT9D113_SCENE_SETTING_SIZE 12
#define MT9D113_REG_READ_ADDR 0x0010
#define MT9D113_SCENE_ANALOG_GAIN_CODE_GLOBAL 0x0012
#define MT9D113_SCENE_CORSE_INTEGRATION_TIME  0x008C

#define MT9D113_ERR_CHK_VAL 0x032A

DEFINE_MUTEX(mt9d113_mut);
static struct msm_sensor_ctrl_t mt9d113_s_ctrl;

static int8_t mt9d113_wb = MT9D113_WB_NONE;
static int8_t mt9d113_wb_wait = MT9D113_WB_NONE;

static struct workqueue_struct *mt9d113_wq;

typedef struct {
    struct work_struct work;
    struct msm_sensor_ctrl_t *s_ctrl;
} mt9d113_work_t;

static mt9d113_work_t *mt9d113_work;

static struct workqueue_struct *mt9d113_err_chk_wq;
static mt9d113_work_t *mt9d113_err_chk_work;
static volatile int mt9d113_power_on_flg = 0;

struct regulator *reg_l9;
struct regulator *reg_l29;
struct regulator *reglvs2;

static int gpio2,gpio4,gpio68;

static int power_up = 0;

static int mt9d113_sensor_mode = 10; /* SENSOR_MODE_INVALID */
static int mt9d113_snapshot_flg = 0;
static uint32_t mt9d113_exposure_time = 0;
static uint32_t mt9d113_request_res = 0;

static int32_t pre_exp_setting = 0;
static uint8_t mt9d113_skip_frame_flg = 0;
static int effect_value = CAMERA_EFFECT_OFF;
static int effect_value_wait = CAMERA_EFFECT_OFF;
struct msm_sensor_v4l2_ctrl_info_t *ctrl_info_wait;

static int mt9d113_effect_msm_sensor_s_ctrl_by_enum(struct msm_sensor_ctrl_t *s_ctrl,
        struct msm_sensor_v4l2_ctrl_info_t *ctrl_info, int value);
static void msm_sensor_mt9d113_set_skip_frame(void);
int32_t msm_sensor_mt9d113_set_white_balance(struct msm_sensor_ctrl_t *, int8_t);

static uint8_t mt9d113_scene_first_set = 0;
static uint8_t mt9d113_scene_index = 0;

/****************** mod special data for MT9D113 ******************/

static struct msm_camera_i2c_reg_conf mt9d113_recommend_settings[] = {
 {0x001A,0x0051},
 {0x001A,0x0050},
 {0x001A,0x0050},
 {0x001A,0x0058},
 {0x0014,0x2545},
 {0x0010,0x032A},
 {0x0012,0x00F5},
 {0x0014,0x2447},
 {0x0014,0x2047},
 {0x0014,0x2046},
 {0x0018,0x4028},
 {0x098C,0x2703},
 {0x0990,0x0320},
 {0x098C,0x2705},
 {0x0990,0x0258},
 {0x098C,0x2707},
 {0x0990,0x0640},
 {0x098C,0x2709},
 {0x0990,0x04B0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x080C},
 {0x098C,0x2723},
 {0x0990,0x0004},
 {0x098C,0x2725},
 {0x0990,0x0004},
 {0x098C,0x2727},
 {0x0990,0x04BB},
 {0x098C,0x2729},
 {0x0990,0x064B},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x050D},
 {0x098C,0x2737},
 {0x0990,0x08C0},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x063F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x04AF},
 {0x098C,0x222D},
 {0x0990,0x00AA},
 {0x098C,0xA408},
 {0x0990,0x0029},
 {0x098C,0xA409},
 {0x0990,0x002B},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AA},
 {0x098C,0x2413},
 {0x0990,0x00CC},
 {0x098C,0x2415},
 {0x0990,0x009C},
 {0x098C,0x2417},
 {0x0990,0x00BC},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x364E,0x04D0},
 {0x3650,0x2DC9},
 {0x3652,0x5A11},
 {0x3654,0x77AE},
 {0x3656,0x85D3},
 {0x3658,0x00B0},
 {0x365A,0x23EA},
 {0x365C,0x1C72},
 {0x365E,0x2C0E},
 {0x3660,0xA173},
 {0x3662,0x0190},
 {0x3664,0x4EEB},
 {0x3666,0x5FD1},
 {0x3668,0x3ECC},
 {0x366A,0x8AD3},
 {0x366C,0x00F0},
 {0x366E,0x70E9},
 {0x3670,0x5CB1},
 {0x3672,0x438E},
 {0x3674,0x8EF3},
 {0x3676,0x994B},
 {0x3678,0x8CF0},
 {0x367A,0xF8EF},
 {0x367C,0x3AB2},
 {0x367E,0x2C72},
 {0x3680,0xD149},
 {0x3682,0x05AF},
 {0x3684,0xC2EF},
 {0x3686,0x84B0},
 {0x3688,0x36F2},
 {0x368A,0xC52C},
 {0x368C,0xB8EE},
 {0x368E,0x9111},
 {0x3690,0x62F0},
 {0x3692,0x4A73},
 {0x3694,0xCECA},
 {0x3696,0x270F},
 {0x3698,0xA10D},
 {0x369A,0xD7ED},
 {0x369C,0x2830},
 {0x369E,0x5112},
 {0x36A0,0x042D},
 {0x36A2,0x8833},
 {0x36A4,0x0333},
 {0x36A6,0xC755},
 {0x36A8,0x64F2},
 {0x36AA,0xDCAE},
 {0x36AC,0x6BB2},
 {0x36AE,0x47B4},
 {0x36B0,0xCA17},
 {0x36B2,0x47B2},
 {0x36B4,0xEF0F},
 {0x36B6,0xAE73},
 {0x36B8,0x29D4},
 {0x36BA,0xC294},
 {0x36BC,0x5272},
 {0x36BE,0xC18E},
 {0x36C0,0xC6B3},
 {0x36C2,0x1B33},
 {0x36C4,0xC434},
 {0x36C6,0xAB2D},
 {0x36C8,0x00F2},
 {0x36CA,0x1F94},
 {0x36CC,0xC3B4},
 {0x36CE,0xBF96},
 {0x36D0,0x9B0F},
 {0x36D2,0x3151},
 {0x36D4,0x0215},
 {0x36D6,0x9E95},
 {0x36D8,0xB997},
 {0x36DA,0x408D},
 {0x36DC,0x734F},
 {0x36DE,0x2655},
 {0x36E0,0x9CF0},
 {0x36E2,0xF537},
 {0x36E4,0x4BAD},
 {0x36E6,0x1BD1},
 {0x36E8,0x52B3},
 {0x36EA,0xC075},
 {0x36EC,0x8376},
 {0x36EE,0xA994},
 {0x36F0,0x2291},
 {0x36F2,0xA337},
 {0x36F4,0xB6B6},
 {0x36F6,0x06FA},
 {0x36F8,0xDD73},
 {0x36FA,0x0693},
 {0x36FC,0xD5D8},
 {0x36FE,0x8398},
 {0x3700,0x2F1B},
 {0x3702,0xA6B4},
 {0x3704,0x7533},
 {0x3706,0xAB37},
 {0x3708,0xF4D7},
 {0x370A,0x20BA},
 {0x370C,0xABF4},
 {0x370E,0x54F2},
 {0x3710,0x80B7},
 {0x3712,0xCD16},
 {0x3714,0x57D9},
 {0x3644,0x0314},
 {0x3642,0x0258},
 {0x3210,0x01B8},
 {0x098C,0xAB37},
 {0x0990,0x0000},
 {0x098C,0xAB3C},
 {0x0990,0x0000},
 {0x098C,0xAB3D},
 {0x0990,0x000C},
 {0x098C,0xAB3E},
 {0x0990,0x0020},
 {0x098C,0xAB3F},
 {0x0990,0x0037},
 {0x098C,0xAB40},
 {0x0990,0x0057},
 {0x098C,0xAB41},
 {0x0990,0x0071},
 {0x098C,0xAB42},
 {0x0990,0x0088},
 {0x098C,0xAB43},
 {0x0990,0x009B},
 {0x098C,0xAB44},
 {0x0990,0x00AA},
 {0x098C,0xAB45},
 {0x0990,0x00B8},
 {0x098C,0xAB46},
 {0x0990,0x00C3},
 {0x098C,0xAB47},
 {0x0990,0x00CD},
 {0x098C,0xAB48},
 {0x0990,0x00D6},
 {0x098C,0xAB49},
 {0x0990,0x00DF},
 {0x098C,0xAB4A},
 {0x0990,0x00E6},
 {0x098C,0xAB4B},
 {0x0990,0x00ED},
 {0x098C,0xAB4C},
 {0x0990,0x00F3},
 {0x098C,0xAB4D},
 {0x0990,0x00F9},
 {0x098C,0xAB4E},
 {0x0990,0x00FF},
 {0x098C,0xAB4F},
 {0x0990,0x0000},
 {0x098C,0xAB50},
 {0x0990,0x001A},
 {0x098C,0xAB51},
 {0x0990,0x0024},
 {0x098C,0xAB52},
 {0x0990,0x0037},
 {0x098C,0xAB53},
 {0x0990,0x004F},
 {0x098C,0xAB54},
 {0x0990,0x0067},
 {0x098C,0xAB55},
 {0x0990,0x007D},
 {0x098C,0xAB56},
 {0x0990,0x0090},
 {0x098C,0xAB57},
 {0x0990,0x00A1},
 {0x098C,0xAB58},
 {0x0990,0x00AF},
 {0x098C,0xAB59},
 {0x0990,0x00BC},
 {0x098C,0xAB5A},
 {0x0990,0x00C7},
 {0x098C,0xAB5B},
 {0x0990,0x00D1},
 {0x098C,0xAB5C},
 {0x0990,0x00DA},
 {0x098C,0xAB5D},
 {0x0990,0x00E3},
 {0x098C,0xAB5E},
 {0x0990,0x00EB},
 {0x098C,0xAB5F},
 {0x0990,0x00F2},
 {0x098C,0xAB60},
 {0x0990,0x00F9},
 {0x098C,0xAB61},
 {0x0990,0x00FF},
 {0x098C,0x2B62},
 {0x0990,0xFFFE},
 {0x098C,0x2B64},
 {0x0990,0xFFFF},
 {0x098C,0x2306},
 {0x0990,0x01DB},
 {0x098C,0x2308},
 {0x0990,0xFF10},
 {0x098C,0x230A},
 {0x0990,0xFFF8},
 {0x098C,0x230C},
 {0x0990,0xFF93},
 {0x098C,0x230E},
 {0x0990,0x00F7},
 {0x098C,0x2310},
 {0x0990,0x0079},
 {0x098C,0x2312},
 {0x0990,0xFFF7},
 {0x098C,0x2314},
 {0x0990,0xFE95},
 {0x098C,0x2316},
 {0x0990,0x0275},
 {0x098C,0x2318},
 {0x0990,0x0028},
 {0x098C,0x231A},
 {0x0990,0x002C},
 {0x098C,0x231C},
 {0x0990,0xFFEB},
 {0x098C,0x231E},
 {0x0990,0xFF9B},
 {0x098C,0x2320},
 {0x0990,0x0010},
 {0x098C,0x2322},
 {0x0990,0x000F},
 {0x098C,0x2324},
 {0x0990,0x00C6},
 {0x098C,0x2326},
 {0x0990,0xFFAD},
 {0x098C,0x2328},
 {0x0990,0x001E},
 {0x098C,0x232A},
 {0x0990,0x00DC},
 {0x098C,0x232C},
 {0x0990,0xFEE9},
 {0x098C,0x232E},
 {0x0990,0x0002},
 {0x098C,0x2330},
 {0x0990,0xFFFF},
 {0x3244,0x0300},
 {0x098C,0xA348},
 {0x0990,0x0006},
 {0x098C,0xA349},
 {0x0990,0x0001},
 {0x098C,0xA34A},
 {0x0990,0x0059},
 {0x098C,0xA34B},
 {0x0990,0x00AF},
 {0x098C,0xA34C},
 {0x0990,0x0059},
 {0x098C,0xA34D},
 {0x0990,0x00C0},
 {0x098C,0xA351},
 {0x0990,0x0000},
 {0x098C,0xA352},
 {0x0990,0x007F},
 {0x098C,0xA35D},
 {0x0990,0x0078},
 {0x098C,0xA35E},
 {0x0990,0x0086},
 {0x098C,0xA35F},
 {0x0990,0x007E},
 {0x098C,0xA360},
 {0x0990,0x0082},
 {0x098C,0xA363},
 {0x0990,0x00E1},
 {0x098C,0xA364},
 {0x0990,0x00EE},
 {0x098C,0xA302},
 {0x0990,0x0000},
 {0x098C,0xA303},
 {0x0990,0x00EF},
 {0x098C,0x2361},
 {0x0990,0x0040},
 {0x098C,0xA366},
 {0x0990,0x0073},
 {0x098C,0xA367},
 {0x0990,0x0080},
 {0x098C,0xA368},
 {0x0990,0x0088},
 {0x098C,0xA369},
 {0x0990,0x007F},
 {0x098C,0xA36A},
 {0x0990,0x0080},
 {0x098C,0xA36B},
 {0x0990,0x0077},
 {0x3240,0xC800},
 {0x3084,0x240C},
 {0x3092,0x0A4C},
 {0x3094,0x4C4C},
 {0x3096,0x4C54},
 {0x098C,0xA109},
 {0x0990,0x0006},
 {0x098C,0xA10A},
 {0x0990,0x0001},
 {0x098C,0xA10B},
 {0x0990,0x0006},
 {0x098C,0xA10C},
 {0x0990,0x0001},
 {0x098C,0xA115},
 {0x0990,0x0070},
 {0x098C,0xA117},
 {0x0990,0x0002},
 {0x098C,0xA11D},
 {0x0990,0x0002},
 {0x098C,0xA123},
 {0x0990,0x0002},
 {0x098C,0xA129},
 {0x0990,0x0002},
 {0x098C,0xA207},
 {0x0990,0x000A},
 {0x098C,0xA20D},
 {0x0990,0x0010},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA20E},
 {0x0990,0x0086},
 {0x098C,0x2212},
 {0x0990,0x0120},
 {0x098C,0x2240},
 {0x0990,0x013F},
 {0x098C,0x2242},
 {0x0990,0x00AB},
 {0x098C,0xA24F},
 {0x0990,0x0041},
 {0x098C,0x2304},
 {0x0990,0x01F4},
 {0x098C,0x275F},
 {0x0990,0x0596},
 {0x098C,0x2761},
 {0x0990,0x0094},
 {0x098C,0xA765},
 {0x0990,0x0006},
 {0x098C,0xAB04},
 {0x0990,0x0023},
 {0x098C,0xAB06},
 {0x0990,0x0008},
 {0x098C,0xAB07},
 {0x0990,0x0002},
 {0x098C,0xAB1F},
 {0x0990,0x0086},
 {0x098C,0xAB20},
 {0x0990,0x0032},
 {0x098C,0xAB22},
 {0x0990,0x0007},
 {0x098C,0xAB23},
 {0x0990,0x0006},
 {0x098C,0xAB24},
 {0x0990,0x0000},
 {0x098C,0xAB25},
 {0x0990,0x0070},
 {0x098C,0xAB26},
 {0x0990,0x0000},
 {0x098C,0xAB27},
 {0x0990,0x0050},
 {0x098C,0x2B28},
 {0x0990,0x0F80},
 {0x098C,0x2B2A},
 {0x0990,0x4F00},
 {0x098C,0xAB30},
 {0x0990,0x001E},
 {0x098C,0xAB31},
 {0x0990,0x001E},
 {0x098C,0xAB32},
 {0x0990,0x001E},
 {0x098C,0xAB33},
 {0x0990,0x001E},
 {0x098C,0xAB34},
 {0x0990,0x0008},
 {0x098C,0xAB35},
 {0x0990,0x0080},
 {0x098C,0xAB36},
 {0x0990,0x0014},
 {0x098C,0xAB37},
 {0x0990,0x0003},
 {0x098C,0x2B38},
 {0x0990,0x1E14},
 {0x098C,0x2B3A},
 {0x0990,0x3000},
 {0x098C,0x2B66},
 {0x0990,0x4F00},
 {0x098C,0xA103},
 {0x0990,0x0006},
};

static struct msm_camera_i2c_reg_conf mt9d113_config_exposure_settings[MT9D113_EXPOSURE_TBL_SIZE][MT9D113_EXPOSURE_SETTING_SIZE] = {
 /* -7 */
// {

// },
 /* -6 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0013},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* -5 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x001A},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* -4 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0024},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* -3 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x002D},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* -2 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0033},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* -1 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x003A},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 0 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0000},
  {0x098C,0xA75E},
  {0x0990,0x0000},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 1 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0011},
  {0x098C,0xA75E},
  {0x0990,0x0011},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 2 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0022},
  {0x098C,0xA75E},
  {0x0990,0x0022},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 3 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0033},
  {0x098C,0xA75E},
  {0x0990,0x0033},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 4 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0044},
  {0x098C,0xA75E},
  {0x0990,0x0044},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 5 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0055},
  {0x098C,0xA75E},
  {0x0990,0x0055},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 6 */
 {
  {0x098C,0xA207},
  {0x0990,0x000A},
  {0x098C,0xA24F},
  {0x0990,0x0041},
  {0x098C,0xA75D},
  {0x0990,0x0066},
  {0x098C,0xA75E},
  {0x0990,0x0066},
  {0x098C,0xA103},
  {0x0990,0x0005},
 },
 /* 7 */
// {

// },
};

static struct msm_camera_i2c_reg_conf mt9d113_config_white_balance_settings[MT9D113_WB_MAX][MT9D113_WB_SETTING_SIZE] = {
  /* MT9D113_WB_AUTO */
  {
    {0x098C, 0xA34A},
    {0x0990, 0x0059},
    {0x098C, 0xA34B},
    {0x0990, 0x00AF},
    {0x098C, 0xA34C},
    {0x0990, 0x0059},
    {0x098C, 0xA34D},
    {0x0990, 0x00C0},
    {0x098C, 0xA351},
    {0x0990, 0x0000},
    {0x098C, 0xA352},
    {0x0990, 0x007F},
  },
  /* MT9D113_WB_DAYLIGHT */
  {
    {0x098C, 0xA34A},
    {0x0990, 0x007D},
    {0x098C, 0xA34B},
    {0x0990, 0x00AF},
    {0x098C, 0xA34C},
    {0x0990, 0x0050},
    {0x098C, 0xA34D},
    {0x0990, 0x0078},
    {0x098C, 0xA351},
    {0x0990, 0x0070},
    {0x098C, 0xA352},
    {0x0990, 0x007F},
  },
  /* MT9D113_WB_FLUORESCENT */
  {
    {0x098C, 0xA34A},
    {0x0990, 0x0078},
    {0x098C, 0xA34B},
    {0x0990, 0x00A0},
    {0x098C, 0xA34C},
    {0x0990, 0x0064},
    {0x098C, 0xA34D},
    {0x0990, 0x008C},
    {0x098C, 0xA351},
    {0x0990, 0x0040},
    {0x098C, 0xA352},
    {0x0990, 0x007F},
  },
  /* MT9D113_WB_CLOUDY_DAYLIGHT */
  {
    {0x098C, 0xA34A},
    {0x0990, 0x006E},
    {0x098C, 0xA34B},
    {0x0990, 0x0096},
    {0x098C, 0xA34C},
    {0x0990, 0x005A},
    {0x098C, 0xA34D},
    {0x0990, 0x0082},
    {0x098C, 0xA351},
    {0x0990, 0x0050},
    {0x098C, 0xA352},
    {0x0990, 0x007F},
  },
  /* MT9D113_WB_INCANDESCENT */
  {
    {0x098C, 0xA34A},
    {0x0990, 0x0050},
    {0x098C, 0xA34B},
    {0x0990, 0x0078},
    {0x098C, 0xA34C},
    {0x0990, 0x00A0},
    {0x098C, 0xA34D},
    {0x0990, 0x00C8},
    {0x098C, 0xA351},
    {0x0990, 0x0000},
    {0x098C, 0xA352},
    {0x0990, 0x0020},
  },
};

static struct msm_camera_i2c_reg_conf mt9d113_start_stream_settings[] = {
 {0x301A, 0x12DC },
};

static struct msm_camera_i2c_reg_conf mt9d113_stop_stream_settings[] = {
 {0x301A, 0x12D8 },
};

static struct msm_camera_i2c_reg_conf mt9d113_scene_settings[MT9D113_SCENE_TBL_SIZE][MT9D113_SCENE_SETTING_SIZE] = {
 /* auto */
 {
    {0x098C,0xA34A},
    {0x0990,0x0059},
    {0x098C,0xA34B},
    {0x0990,0x00AF},
    {0x098C,0xA34C},
    {0x0990,0x0059},
    {0x098C,0xA34D},
    {0x0990,0x00C0},
    {0x098C,0xA351},
    {0x0990,0x0000},
    {0x098C,0xA352},
    {0x0990,0x007F},
 },
 /* daylight */
 {
    {0x098C,0xA34A},
    {0x0990,0x0059},
    {0x098C,0xA34B},
    {0x0990,0x00AF},
    {0x098C,0xA34C},
    {0x0990,0x0059},
    {0x098C,0xA34D},
    {0x0990,0x00C0},
    {0x098C,0xA351},
    {0x0990,0x0000},
    {0x098C,0xA352},
    {0x0990,0x007F},
 },
};

static struct msm_camera_i2c_reg_conf mt9d113_prev_settings[] = {
 {0x098C ,0xA115},
 {0x0990 ,0x0070},
 {0x098C ,0xA103},
 {0x0990 ,0x0001},
};

static struct msm_camera_i2c_reg_conf mt9d113_snapshot_settings[] = {
 {0x098C ,0xA115},
 {0x0990 ,0x0072},
 {0x098C ,0xA103},
 {0x0990 ,0x0002},
};

static struct v4l2_subdev_info mt9d113_subdev_info[] = {
 {
 .code   = V4L2_MBUS_FMT_YUYV8_2X8,
 .colorspace = V4L2_COLORSPACE_JPEG,
 .fmt    = 1,
 .order    = 0,
 },
 /* more can be supported, to be added later */
};


//static void mt9d113_stop_stream(struct msm_sensor_ctrl_t *s_ctrl) {}


static struct msm_camera_i2c_conf_array mt9d113_init_conf[] = {
 {&mt9d113_recommend_settings[0],
 ARRAY_SIZE(mt9d113_recommend_settings), 0, MSM_CAMERA_I2C_WORD_DATA}
};

static struct msm_camera_i2c_reg_conf mt9d113_output_settings_qcif_p[] = {
 {0x098C,0x2703},
 {0x0990,0x00B0},
 {0x098C,0x2705},
 {0x0990,0x0090},
 {0x098C,0x2707},
 {0x0990,0x00B0},
 {0x098C,0x2709},
 {0x0990,0x0090},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x0566},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};

static struct msm_camera_i2c_reg_conf mt9d113_output_settings_qvga_p[] = {
 {0x098C,0x2703},
 {0x0990,0x0140},
 {0x098C,0x2705},
 {0x0990,0x00F0},
 {0x098C,0x2707},
 {0x0990,0x0140},
 {0x098C,0x2709},
 {0x0990,0x00F0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x0566},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};

static struct msm_camera_i2c_reg_conf mt9d113_output_settings_vga_p[] = {
 {0x098C,0x2703},
 {0x0990,0x0280},
 {0x098C,0x2705},
 {0x0990,0x01E0},
 {0x098C,0x2707},
 {0x0990,0x0280},
 {0x098C,0x2709},
 {0x0990,0x01E0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x0566},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_wvga_p[] = {
 {0x098C,0x2703},
 {0x0990,0x0320},
 {0x098C,0x2705},
 {0x0990,0x01E0},
 {0x098C,0x2707},
 {0x0990,0x0320},
 {0x098C,0x2709},
 {0x0990,0x01E0},
 {0x098C,0x270D},
 {0x0990,0x0078},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x0445},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0078},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x0445},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x0566},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x01DF},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x01DF},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};

static struct msm_camera_i2c_reg_conf mt9d113_output_settings_HD_p[] = {
 {0x098C,0x2703},
 {0x0990,0x0320},
 {0x098C,0x2705},
 {0x0990,0x01C0},
 {0x098C,0x2707},
 {0x0990,0x0500},
 {0x098C,0x2709},
 {0x0990,0x02D0},
 {0x098C,0x270D},
 {0x0990,0x0098},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x0425},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x009C},
 {0x098C,0x2725},
 {0x0990,0x0006},
 {0x098C,0x2727},
 {0x0990,0x0427},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x050D},
 {0x098C,0x2737},
 {0x0990,0x0875},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x01BF},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x063F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0383},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00A2},
 {0x098C,0x2417},
 {0x0990,0x00C2},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_sxga[] = {
 {0x098C,0x2703},
 {0x0990,0x0280},
 {0x098C,0x2705},
 {0x0990,0x01E0},
 {0x098C,0x2707},
 {0x0990,0x0500},
 {0x098C,0x2709},
 {0x0990,0x03C0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0004},
 {0x098C,0x2725},
 {0x0990,0x0004},
 {0x098C,0x2727},
 {0x0990,0x04BB},
 {0x098C,0x2729},
 {0x0990,0x064B},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x050D},
 {0x098C,0x2737},
 {0x0990,0x08A1},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x063F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x04AF},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x009E},
 {0x098C,0x2417},
 {0x0990,0x00BE},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};

static struct msm_camera_i2c_reg_conf mt9d113_output_settings_uxga[] = {
 {0x098C,0x2703},
 {0x0990,0x0280},
 {0x098C,0x2705},
 {0x0990,0x01E0},
 {0x098C,0x2707},
 {0x0990,0x0640},
 {0x098C,0x2709},
 {0x0990,0x04B0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0004},
 {0x098C,0x2725},
 {0x0990,0x0004},
 {0x098C,0x2727},
 {0x0990,0x04BB},
 {0x098C,0x2729},
 {0x0990,0x064B},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x050D},
 {0x098C,0x2737},
 {0x0990,0x08A1},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x063F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x04AF},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x009E},
 {0x098C,0x2417},
 {0x0990,0x00BE},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x000A},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_qcif_v[] = {
 {0x098C,0x2703},
 {0x0990,0x00D0},
 {0x098C,0x2705},
 {0x0990,0x00B0},
 {0x098C,0x2707},
 {0x0990,0x00D0},
 {0x098C,0x2709},
 {0x0990,0x00B0},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x02B3},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0003},
 {0x098C,0xA103},
 {0x0990,0x0006},

};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_qvga_v[] = {
 {0x098C,0x2703},
 {0x0990,0x0180},
 {0x098C,0x2705},
 {0x0990,0x0120},
 {0x098C,0x2707},
 {0x0990,0x0180},
 {0x098C,0x2709},
 {0x0990,0x0120},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x02B3},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0003},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_vga_v[] = {
 {0x098C,0x2703},
 {0x0990,0x0300},
 {0x098C,0x2705},
 {0x0990,0x0240},
 {0x098C,0x2707},
 {0x0990,0x0300},
 {0x098C,0x2709},
 {0x0990,0x0240},
 {0x098C,0x270D},
 {0x0990,0x0000},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x04BD},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0000},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x04BD},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x02B3},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x0257},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x0257},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0003},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_wvga_v[] = {
 {0x098C,0x2703},
 {0x0990,0x0320},
 {0x098C,0x2705},
 {0x0990,0x01E0},
 {0x098C,0x2707},
 {0x0990,0x0320},
 {0x098C,0x2709},
 {0x0990,0x01E0},
 {0x098C,0x270D},
 {0x0990,0x0078},
 {0x098C,0x270F},
 {0x0990,0x0000},
 {0x098C,0x2711},
 {0x0990,0x0445},
 {0x098C,0x2713},
 {0x0990,0x064D},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x046F},
 {0x098C,0x2719},
 {0x0990,0x005A},
 {0x098C,0x271B},
 {0x0990,0x01BE},
 {0x098C,0x271D},
 {0x0990,0x0131},
 {0x098C,0x271F},
 {0x0990,0x02B3},
 {0x098C,0x2721},
 {0x0990,0x07EA},
 {0x098C,0x2723},
 {0x0990,0x0078},
 {0x098C,0x2725},
 {0x0990,0x0000},
 {0x098C,0x2727},
 {0x0990,0x0445},
 {0x098C,0x2729},
 {0x0990,0x064D},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x046F},
 {0x098C,0x272F},
 {0x0990,0x005A},
 {0x098C,0x2731},
 {0x0990,0x01BE},
 {0x098C,0x2733},
 {0x0990,0x0131},
 {0x098C,0x2735},
 {0x0990,0x02B3},
 {0x098C,0x2737},
 {0x0990,0x07EA},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x031F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x01DF},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x031F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x01DF},
 {0x098C,0x222D},
 {0x0990,0x00AD},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AD},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AD},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0003},
 {0x098C,0xA103},
 {0x0990,0x0006},
};


static struct msm_camera_i2c_reg_conf mt9d113_output_settings_wvga_vs[] = {
 {0x098C,0x2703},
 {0x0990,0x0500},
 {0x098C,0x2705},
 {0x0990,0x0300},
 {0x098C,0x2707},
 {0x0990,0x0500},
 {0x098C,0x2709},
 {0x0990,0x0300},
 {0x098C,0x270D},
 {0x0990,0x00DE},
 {0x098C,0x270F},
 {0x0990,0x00A6},
 {0x098C,0x2711},
 {0x0990,0x03E5},
 {0x098C,0x2713},
 {0x0990,0x05AD},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x0027},
 {0x098C,0x2719},
 {0x0990,0x003A},
 {0x098C,0x271B},
 {0x0990,0x00F6},
 {0x098C,0x271D},
 {0x0990,0x008B},
 {0x098C,0x271F},
 {0x0990,0x035D},
 {0x098C,0x2721},
 {0x0990,0x07F0},
 {0x098C,0x2723},
 {0x0990,0x00DE},
 {0x098C,0x2725},
 {0x0990,0x00A6},
 {0x098C,0x2727},
 {0x0990,0x03E5},
 {0x098C,0x2729},
 {0x0990,0x05AD},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x035D},
 {0x098C,0x2737},
 {0x0990,0x07F0},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x04FF},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x02FF},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x04FF},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x02FF},
 {0x098C,0x222D},
 {0x0990,0x00AC},
 {0x098C,0xA408},
 {0x0990,0x002A},
 {0x098C,0xA409},
 {0x0990,0x002C},
 {0x098C,0xA40A},
 {0x0990,0x0032},
 {0x098C,0xA40B},
 {0x0990,0x0034},
 {0x098C,0x2411},
 {0x0990,0x00AC},
 {0x098C,0x2413},
 {0x0990,0x00CF},
 {0x098C,0x2415},
 {0x0990,0x00AC},
 {0x098C,0x2417},
 {0x0990,0x00CF},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0004},
 {0x098C,0xA103},
 {0x0990,0x0006},
};
static struct msm_camera_i2c_reg_conf mt9d113_output_settings_HD_v[] = {
 {0x098C,0x2703},
 {0x0990,0x0500},
 {0x098C,0x2705},
 {0x0990,0x02D0},
 {0x098C,0x2707},
 {0x0990,0x0500},
 {0x098C,0x2709},
 {0x0990,0x02D0},
 {0x098C,0x270D},
 {0x0990,0x00F6},
 {0x098C,0x270F},
 {0x0990,0x00A6},
 {0x098C,0x2711},
 {0x0990,0x03CD},
 {0x098C,0x2713},
 {0x0990,0x05AD},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x0027},
 {0x098C,0x2719},
 {0x0990,0x003A},
 {0x098C,0x271B},
 {0x0990,0x00F6},
 {0x098C,0x271D},
 {0x0990,0x008B},
 {0x098C,0x271F},
 {0x0990,0x032D},
 {0x098C,0x2721},
 {0x0990,0x0868},
 {0x098C,0x2723},
 {0x0990,0x00F6},
 {0x098C,0x2725},
 {0x0990,0x00A6},
 {0x098C,0x2727},
 {0x0990,0x03CD},
 {0x098C,0x2729},
 {0x0990,0x05AD},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x032D},
 {0x098C,0x2737},
 {0x0990,0x0868},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x04FF},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x02CF},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x04FF},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x02CF},
 {0x098C,0x222D},
 {0x0990,0x00A3},
 {0x098C,0xA408},
 {0x0990,0x0027},
 {0x098C,0xA409},
 {0x0990,0x0029},
 {0x098C,0xA40A},
 {0x0990,0x002F},
 {0x098C,0xA40B},
 {0x0990,0x0031},
 {0x098C,0x2411},
 {0x0990,0x00A3},
 {0x098C,0x2413},
 {0x0990,0x00C3},
 {0x098C,0x2415},
 {0x0990,0x00A3},
 {0x098C,0x2417},
 {0x0990,0x00C3},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0004},
 {0x098C,0xA103},
 {0x0990,0x0006},
};


static struct msm_camera_i2c_reg_conf mt9d113_output_settings_HD_vs[] = {
 {0x098C,0x2703},
 {0x0990,0x0590},
 {0x098C,0x2705},
 {0x0990,0x0320},
 {0x098C,0x2707},
 {0x0990,0x0590},
 {0x098C,0x2709},
 {0x0990,0x0320},
 {0x098C,0x270D},
 {0x0990,0x00CE},
 {0x098C,0x270F},
 {0x0990,0x005E},
 {0x098C,0x2711},
 {0x0990,0x03F5},
 {0x098C,0x2713},
 {0x0990,0x05F5},
 {0x098C,0x2715},
 {0x0990,0x0111},
 {0x098C,0x2717},
 {0x0990,0x0027},
 {0x098C,0x2719},
 {0x0990,0x003A},
 {0x098C,0x271B},
 {0x0990,0x00F6},
 {0x098C,0x271D},
 {0x0990,0x008B},
 {0x098C,0x271F},
 {0x0990,0x037D},
 {0x098C,0x2721},
 {0x0990,0x092F},
 {0x098C,0x2723},
 {0x0990,0x00CE},
 {0x098C,0x2725},
 {0x0990,0x005E},
 {0x098C,0x2727},
 {0x0990,0x03F5},
 {0x098C,0x2729},
 {0x0990,0x05F5},
 {0x098C,0x272B},
 {0x0990,0x0111},
 {0x098C,0x272D},
 {0x0990,0x0027},
 {0x098C,0x272F},
 {0x0990,0x003A},
 {0x098C,0x2731},
 {0x0990,0x00F6},
 {0x098C,0x2733},
 {0x0990,0x008B},
 {0x098C,0x2735},
 {0x0990,0x037D},
 {0x098C,0x2737},
 {0x0990,0x092F},
 {0x098C,0x2739},
 {0x0990,0x0000},
 {0x098C,0x273B},
 {0x0990,0x058F},
 {0x098C,0x273D},
 {0x0990,0x0000},
 {0x098C,0x273F},
 {0x0990,0x031F},
 {0x098C,0x2747},
 {0x0990,0x0000},
 {0x098C,0x2749},
 {0x0990,0x058F},
 {0x098C,0x274B},
 {0x0990,0x0000},
 {0x098C,0x274D},
 {0x0990,0x031F},
 {0x098C,0x222D},
 {0x0990,0x0095},
 {0x098C,0xA408},
 {0x0990,0x0024},
 {0x098C,0xA409},
 {0x0990,0x0026},
 {0x098C,0xA40A},
 {0x0990,0x002B},
 {0x098C,0xA40B},
 {0x0990,0x002D},
 {0x098C,0x2411},
 {0x0990,0x0095},
 {0x098C,0x2413},
 {0x0990,0x00B3},
 {0x098C,0x2415},
 {0x0990,0x0095},
 {0x098C,0x2417},
 {0x0990,0x00B3},
 {0x098C,0xA404},
 {0x0990,0x0030},
 {0x098C,0xA40D},
 {0x0990,0x0002},
 {0x098C,0xA40E},
 {0x0990,0x0003},
 {0x098C,0xA410},
 {0x0990,0x0008},
 {0x098C,0xA20C},
 {0x0990,0x0005},
 {0x098C,0xA103},
 {0x0990,0x0006},
};


static struct msm_camera_i2c_conf_array mt9d113_confs[] = {
 /* UXGA Still */
 {&mt9d113_output_settings_uxga[0],
 ARRAY_SIZE(mt9d113_output_settings_uxga), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* SXGA(1.2M) Still */
 {&mt9d113_output_settings_sxga[0],
 ARRAY_SIZE(mt9d113_output_settings_sxga), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* HD(1M) Still */
 {&mt9d113_output_settings_HD_p[0],
 ARRAY_SIZE(mt9d113_output_settings_HD_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* WVGA Still */
 {&mt9d113_output_settings_wvga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_wvga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* VGA Still */
 {&mt9d113_output_settings_vga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_vga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* QVGA Still */
 {&mt9d113_output_settings_qvga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_qvga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* QCIF Still */
 {&mt9d113_output_settings_qcif_p[0],
 ARRAY_SIZE(mt9d113_output_settings_qcif_p), 0, MSM_CAMERA_I2C_WORD_DATA},

  /* HD(1M) Preview */
 {&mt9d113_output_settings_HD_p[0],
 ARRAY_SIZE(mt9d113_output_settings_HD_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* WVGA  Preview */
 {&mt9d113_output_settings_wvga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_wvga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* UXGA SXGA VGA Preview */
 {&mt9d113_output_settings_vga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_vga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* QVGA Preview */
 {&mt9d113_output_settings_qvga_p[0],
 ARRAY_SIZE(mt9d113_output_settings_qvga_p), 0, MSM_CAMERA_I2C_WORD_DATA},
  /* QCIF Preview */
 {&mt9d113_output_settings_qcif_p[0],
 ARRAY_SIZE(mt9d113_output_settings_qcif_p), 0, MSM_CAMERA_I2C_WORD_DATA},

 /* QCIF Movie */
 {&mt9d113_output_settings_qcif_v[0],
 ARRAY_SIZE(mt9d113_output_settings_qcif_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* QVGA Movie */
 {&mt9d113_output_settings_qvga_v[0],
 ARRAY_SIZE(mt9d113_output_settings_qvga_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* VGA Movie */
 {&mt9d113_output_settings_vga_v[0],
 ARRAY_SIZE(mt9d113_output_settings_vga_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* WVGA Movie */
 {&mt9d113_output_settings_wvga_v[0],
 ARRAY_SIZE(mt9d113_output_settings_wvga_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* WVGA Movie image stabilizer  */
 {&mt9d113_output_settings_wvga_vs[0],
 ARRAY_SIZE(mt9d113_output_settings_wvga_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* HD Movie */
 {&mt9d113_output_settings_HD_v[0],
 ARRAY_SIZE(mt9d113_output_settings_HD_v), 0, MSM_CAMERA_I2C_WORD_DATA},
 /* HD Movie image stabilizer  */
 {&mt9d113_output_settings_HD_vs[0],
 ARRAY_SIZE(mt9d113_output_settings_HD_v), 0, MSM_CAMERA_I2C_WORD_DATA},
};

static struct msm_camera_i2c_reg_conf mt9d113_special_effect[][8] = {
  /*for special effect OFF*/
  {
   {0x098C,0x2759},
   {0x0990,0x6440},
   {0x098C,0x275B},
   {0x0990,0x6440},
   {0x098C,0xA103},
   {0x0990,0x0005},
  },
  /*for special effect MONO*/
  {
   {0x098C,0x2759},
   {0x0990,0x6441},
   {0x098C,0x275B},
   {0x0990,0x6441},
   {0x098C,0xA103},
   {0x0990,0x0005},
  },
  /*for special efefct Negative*/
  {
   {0x098C,0x2759},
   {0x0990,0x6443},
   {0x098C,0x275B},
   {0x0990,0x6443},
   {0x098C,0xA103},
   {0x0990,0x0005},
  },
  /*Solarize is not supported by sensor*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*for sepia*/
  {
   {0x098C,0x2759},
   {0x0990,0x6442},
   {0x098C,0x275B},
   {0x0990,0x6442},
   {0x098C,0xA103},
   {0x0990,0x0005},
  },
  /* Posteraize not supported */
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /* White board not supported*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*Blackboard not supported*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*Aqua not supported*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*Emboss not supported */
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*sketch not supported*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*Neon not supported*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
  /*MAX value*/
  {{-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},
    {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1}, {-1, -1, -1},},
};

static struct msm_camera_i2c_conf_array mt9d113_special_effect_confs[][1] = {
  {{mt9d113_special_effect[0],  ARRAY_SIZE(mt9d113_special_effect[0]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[1],  ARRAY_SIZE(mt9d113_special_effect[1]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[2],  ARRAY_SIZE(mt9d113_special_effect[2]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[3],  ARRAY_SIZE(mt9d113_special_effect[3]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[4],  ARRAY_SIZE(mt9d113_special_effect[4]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[5],  ARRAY_SIZE(mt9d113_special_effect[5]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[6],  ARRAY_SIZE(mt9d113_special_effect[6]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[7],  ARRAY_SIZE(mt9d113_special_effect[7]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[8],  ARRAY_SIZE(mt9d113_special_effect[8]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[9],  ARRAY_SIZE(mt9d113_special_effect[9]),  0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[10], ARRAY_SIZE(mt9d113_special_effect[10]), 0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[11], ARRAY_SIZE(mt9d113_special_effect[11]), 0,
    MSM_CAMERA_I2C_WORD_DATA},},
  {{mt9d113_special_effect[12], ARRAY_SIZE(mt9d113_special_effect[12]), 0,
    MSM_CAMERA_I2C_WORD_DATA},},
};

static int mt9d113_special_effect_enum_map[] = {
  MSM_V4L2_EFFECT_OFF,
  MSM_V4L2_EFFECT_MONO,
  MSM_V4L2_EFFECT_NEGATIVE,
  MSM_V4L2_EFFECT_SOLARIZE,
  MSM_V4L2_EFFECT_SEPIA,
  MSM_V4L2_EFFECT_POSTERAIZE,
  MSM_V4L2_EFFECT_WHITEBOARD,
  MSM_V4L2_EFFECT_BLACKBOARD,
  MSM_V4L2_EFFECT_AQUA,
  MSM_V4L2_EFFECT_EMBOSS,
  MSM_V4L2_EFFECT_SKETCH,
  MSM_V4L2_EFFECT_NEON,
  MSM_V4L2_EFFECT_MAX,
};

static struct msm_camera_i2c_enum_conf_array
  mt9d113_special_effect_enum_confs = {
  .conf = &mt9d113_special_effect_confs[0][0],
  .conf_enum = mt9d113_special_effect_enum_map,
  .num_enum = ARRAY_SIZE(mt9d113_special_effect_enum_map),
  .num_index = ARRAY_SIZE(mt9d113_special_effect_confs),
  .num_conf = ARRAY_SIZE(mt9d113_special_effect_confs[0]),
  .data_type = MSM_CAMERA_I2C_WORD_DATA,
};

static struct msm_camera_i2c_conf_array mt9d113_saturation_confs[][2] = {
};

static int mt9d113_saturation_enum_map[] = {
};

static struct msm_camera_i2c_enum_conf_array mt9d113_saturation_enum_confs = {
 .conf = &mt9d113_saturation_confs[0][0],
 .conf_enum = mt9d113_saturation_enum_map,
 .num_enum = ARRAY_SIZE(mt9d113_saturation_enum_map),
 .num_index = ARRAY_SIZE(mt9d113_saturation_confs),
 .num_conf = ARRAY_SIZE(mt9d113_saturation_confs[0]),
 .data_type = MSM_CAMERA_I2C_WORD_DATA,
};

struct msm_sensor_v4l2_ctrl_info_t mt9d113_v4l2_ctrl_info[] = {
 {
  .ctrl_id = V4L2_CID_SATURATION,
  .min = MSM_V4L2_SATURATION_L0,
  .max = MSM_V4L2_SATURATION_L10,
  .step = 1,
  .enum_cfg_settings = &mt9d113_saturation_enum_confs,
  .s_v4l2_ctrl = msm_sensor_s_ctrl_by_enum,
 },
 {
  .ctrl_id = V4L2_CID_SPECIAL_EFFECT,
  .min = MSM_V4L2_EFFECT_OFF,
  .max = MSM_V4L2_EFFECT_SEPIA,
  .step = 1,
  .enum_cfg_settings = &mt9d113_special_effect_enum_confs,
  .s_v4l2_ctrl = mt9d113_effect_msm_sensor_s_ctrl_by_enum,
 },
};

static struct msm_sensor_output_info_t mt9d113_dimensions[] = {
 {
  /* UXGA(2M) Still */
  .x_output = 0x640,            /* 1600 */
  .y_output = 0x4B0,            /* 1200 */
  .line_length_pclk = 0x8A1,    /* 2209 */
  .frame_length_lines = 0x50D,  /* 1293 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 42843555,     
  .binning_factor = 1,
 },
 {
  /* SXGA(1.2M) Still */
  .x_output = 0x500,            /* 1280 */
  .y_output = 0x3C0,            /* 960 */
  .line_length_pclk = 0xA63,    /* 2659 */
  .frame_length_lines = 0x41D,  /* 1053 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998905,     
  .binning_factor = 1,
 },
 {
  /* HD(1M) Still */
  .x_output = 0x500,            /* 1280 */
  .y_output = 0x2D0,            /* 720 */
  .line_length_pclk = 0xD74,    /* 3444 */
  .frame_length_lines = 0x32D,  /* 813 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41999580,     
  .binning_factor = 1,
 },
 {
  /* WVGA Still */
  .x_output = 0x320,            /* 800 */
  .y_output = 0x1E0,            /* 480 */
  .line_length_pclk = 0xFD4,    /* 4052 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* VGA Still */
  .x_output = 0x280,            /* 640 */
  .y_output = 0x1E0,            /* 480 */
  .line_length_pclk = 0xFD4,    /* 4052 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QVGA Still */
  .x_output = 0x140,            /* 320 */
  .y_output = 0xF0,             /* 240 */
  .line_length_pclk = 0xFD4,    /* 4052 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QCIF Still */
  .x_output = 0xB0,             /* 176 */
  .y_output = 0x90,             /* 144 */
  .line_length_pclk = 0xFD4,    /* 4052 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },

 {
  /* HD(1M) Preview */
  .x_output = 0x320,            /* 800 */
  .y_output = 0x1C0,            /* 448 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* WVGA Preview */
  .x_output = 0x320,            /* 800 */
  .y_output = 0x1E0,            /* 480 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* UXGA SXGA VGA Preview */
  .x_output = 0x280,            /* 640 */
  .y_output = 0x1E0,            /* 480 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QVGA Preview */
  .x_output = 0x140,            /* 320 */
  .y_output = 0xF0,             /* 240 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QCIF Preview */
  .x_output = 0xB0,             /* 176 */
  .y_output = 0x90,             /* 144 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QCIF Movie */
  .x_output = 0xD0,             /* 208 */
  .y_output = 0xB0,             /* 176 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* QVGA Movie */
  .x_output = 0x180,            /* 384 */
  .y_output = 0x120,            /* 288 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* VGA Movie */
  .x_output = 0x300,            /* 768 */
  .y_output = 0x240,            /* 576 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* WVGA Movie */
  .x_output = 0x320,            /* 800 */
  .y_output = 0x1E0,            /* 480 */
  .line_length_pclk = 0x7EA,    /* 2026 */
  .frame_length_lines = 0x2B3,  /* 691 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41998980,     
  .binning_factor = 1,
 },
 {
  /* WVGA Movie image stabilizer  */
  .x_output = 0x500,            /* 1280 */
  .y_output = 0x300,            /* 768 */
  .line_length_pclk = 0x7F0,    /* 2032 */
  .frame_length_lines = 0x35D,  /* 861 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41989248,     
  .binning_factor = 1,
 },
 {
  /* HD Movie */
  .x_output = 0x500,            /* 1280 */
  .y_output = 0x2D0,            /* 720 */
  .line_length_pclk = 0x868,    /* 2152 */
  .frame_length_lines = 0x32D,  /* 813 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41989824,     
  .binning_factor = 1,
 },
 {
  /* HD Movie image stabilizer  */
  .x_output = 0x590,            /* 1424 */
  .y_output = 0x320,            /* 800 */
  .line_length_pclk = 0x92F,    /* 2351 */
  .frame_length_lines = 0x37D,  /* 893 */
  .op_pixel_clk = 252000000,    
  .vt_pixel_clk = 41988860,     
  .binning_factor = 1,
 },
};

static struct msm_camera_csid_vc_cfg mt9d113_cid_cfg[] = {
 {0, CSI_YUV422_8, CSI_DECODE_8BIT},
 {1, CSI_EMBED_DATA, CSI_DECODE_8BIT},
};

static struct msm_camera_csi2_params mt9d113_csi_params = {
 .csid_params = {
  .lane_cnt = 1,
  .lut_params = {
   .num_cid = ARRAY_SIZE(mt9d113_cid_cfg),
   .vc_cfg = mt9d113_cid_cfg,
  },
 },
 .csiphy_params = {
  .lane_cnt = 1,
  .settle_cnt = 0x14,
 },
};

static struct msm_camera_csi2_params *mt9d113_csi_params_array[] = {
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
 &mt9d113_csi_params,
};

static struct msm_sensor_output_reg_addr_t mt9d113_reg_addr = {
 .x_output = 0x2703,
 .y_output = 0x2705,
 .line_length_pclk = 0x2703,
 .frame_length_lines = 0x2705,
};

static struct msm_sensor_id_info_t mt9d113_id_info = {
 .sensor_id_reg_addr = 0x0,
 .sensor_id = 0x2580,
};

static bool camera_power_on = false;
static struct msm_cam_clk_info cam_clk_info[] = {
 {"cam_clk", MSM_SENSOR_MCLK_24HZ},
};


static int mt9d113_effect_msm_sensor_s_ctrl_by_enum(struct msm_sensor_ctrl_t *s_ctrl,
        struct msm_sensor_v4l2_ctrl_info_t *ctrl_info, int value)
{
  int rc = 0;

  KC_CAM_CDBG("%s: E value = %d \n", __func__, value);
  effect_value_wait = value;
  ctrl_info_wait=ctrl_info;
  if(power_up == 0)
  {
     KC_CAM_CDBG("%s: power_up == 0  rc = %d\n", __func__, rc);
     return 0;
  }

  if (effect_value == value) 
  {
      KC_CAM_CDBG("%s: effect_value no change \n", __func__);
      return 0;
  }

  effect_value = value;

  if ((effect_value == CAMERA_EFFECT_OFF) ||
        (effect_value == CAMERA_EFFECT_MONO) ||
        (effect_value == CAMERA_EFFECT_NEGATIVE) ||
        (effect_value == CAMERA_EFFECT_SEPIA)) 
  {
        KC_CAM_CDBG("%s: set\n", __func__);
        rc = msm_sensor_write_enum_conf_array(
            s_ctrl->sensor_i2c_client,
            ctrl_info->enum_cfg_settings, value);
        if (rc < 0) 
        {
            pr_err("%s: i2c write err \n", __func__);
            msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        }
        msm_sensor_mt9d113_set_skip_frame();
  }
  KC_CAM_CDBG("%s: X rc = %d \n", __func__, rc);
  return rc;
}

int32_t mt9d113_get_exp_time(struct msm_sensor_ctrl_t *s_ctrl , uint32_t *exposure_time)
{
    int32_t rc = 0;

    uint32_t line_length_pck         = 0x00000000;
    uint32_t corse_integration_time  = 0x00000000;
    uint32_t fine_integration_time   = 0x00000000;
    uint32_t vt_pix_clk_freq_mhz     = 0x00000000;
    uint16_t r_data;

    uint16_t pll_divider    = 0x0000;
    uint16_t pll_p_divider  = 0x0000;

    uint16_t pll_divider_m  = 0x0000;
    uint16_t pll_divider_n  = 0x0000;
    uint16_t pll_divider_p1 = 0x0000;

    KC_CAM_CDBG("%s: start \n",__func__);

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x0010,
          &pll_divider,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x0012,
          &pll_p_divider,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }

    KC_CAM_CDBG("EXIF1:0x%04x,0x%04x\n", pll_divider, pll_p_divider);

    /* Calculation of "vt_pix_clk_freq_mhz" */
    pll_divider_m  = pll_divider & 0x00FF;
    pll_divider_n  = (pll_divider & 0x3F00) >> 8;
    pll_divider_p1 = pll_p_divider & 0x000F;
    vt_pix_clk_freq_mhz = (uint32_t)( (24*pll_divider_m)/((pll_divider_n+1)*(pll_divider_p1+1)) );

    KC_CAM_CDBG("EXIF2:0x%04x\n", vt_pix_clk_freq_mhz);

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x300C,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }
    line_length_pck = (uint32_t)r_data;

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x3012,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }
    corse_integration_time = (uint32_t)r_data;

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x3014,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }
    fine_integration_time = (uint32_t)r_data;

    KC_CAM_CDBG("%s: line_length_pck=%x corse_integration_time=%x fine_integration_time=%x \n",
                __func__,line_length_pck,corse_integration_time,fine_integration_time);

    /* ms */
    *exposure_time = ((corse_integration_time * line_length_pck) + fine_integration_time) / (vt_pix_clk_freq_mhz * 1000);

    KC_CAM_CDBG("%s: time[ms]=%d \n",__func__,*exposure_time);

failure:
    return rc;
    KC_CAM_CDBG("%s: end \n",__func__);
}

int32_t msm_sensor_mt9d113_get_exp_time(struct msm_sensor_ctrl_t *s_ctrl, uint32_t *exposure_time)
{
    int32_t rc = 0;

    KC_CAM_CDBG("%s: E\n", __func__);

    *exposure_time = mt9d113_exposure_time;

    KC_CAM_CDBG("%s: exposure_time = %d\n", __func__, *exposure_time);

    KC_CAM_CDBG("%s: X rc = %d\n", __func__, rc);
    return rc;
}

int32_t mt9d113_sensor_write_init_settings(struct msm_sensor_ctrl_t *s_ctrl)
{
 int32_t rc = 0;
 int32_t count = 0;
 uint16_t reg_data = 0x0001;
 KC_CAM_CDBG("%s start\n",__func__);

 while (1) 
 {
  reg_data = 0;
  rc = msm_camera_i2c_write(s_ctrl->sensor_i2c_client,
   0x098C, 0xA103,
   MSM_CAMERA_I2C_WORD_DATA);

  rc = msm_camera_i2c_read(s_ctrl->sensor_i2c_client,
   0x0990, &reg_data,
   MSM_CAMERA_I2C_WORD_DATA);
  if(reg_data == 0x0000)
  {
   KC_CAM_CDBG("%s reg_data = 0x%x\n",__func__,reg_data);
   break;
  }
  else
  {
   KC_CAM_CDBG("%s reg_data = 0x%x\n",__func__,reg_data);
   msleep(10);
   count++;
   if (count == 20) 
   {
    KC_CAM_CDBG("%s count == 20\n",__func__);
    break;
   }
  }
 }

 rc = msm_camera_i2c_write(s_ctrl->sensor_i2c_client,
  0x098C, 0xA103,
  MSM_CAMERA_I2C_WORD_DATA);

 rc = msm_camera_i2c_write(s_ctrl->sensor_i2c_client,
  0x0990, 0x0005,
  MSM_CAMERA_I2C_WORD_DATA);

 
 count = 0;
 while (1) 
 {
  reg_data = 0;
  rc = msm_camera_i2c_write(s_ctrl->sensor_i2c_client,
   0x098C, 0xA103,
   MSM_CAMERA_I2C_WORD_DATA);

  rc = msm_camera_i2c_read(s_ctrl->sensor_i2c_client,
   0x0990, &reg_data,
   MSM_CAMERA_I2C_WORD_DATA);
  if(reg_data == 0x0000)
  {
   KC_CAM_CDBG("%s reg_data = 0x%x\n",__func__,reg_data);
   break;
  }
  else
  {
   KC_CAM_CDBG("%s reg_data = 0x%x\n",__func__,reg_data);
   msleep(10);
   count++;
   if (count == 20) 
   {
    KC_CAM_CDBG("%s count == 20\n",__func__);
    break;
   }
  }
 }

 KC_CAM_CDBG("%s end \n",__func__);

 return rc;
}

int32_t msm_sensor_mt9d113_write_output_settings(struct msm_sensor_ctrl_t *s_ctrl,
    uint16_t res)
{
  int32_t rc = -EFAULT;

  KC_CAM_CDBG("%s: res = %d \n",__func__,res);

  rc = msm_sensor_write_all_conf_array(
          s_ctrl->sensor_i2c_client,
          &mt9d113_confs[res],
          1);

  rc = mt9d113_sensor_write_init_settings(s_ctrl);

  rc = 1;
  KC_CAM_CDBG("%s: end\n",__func__);
  return rc;
}

int32_t msm_sensor_mt9d113_write_res_settings(struct msm_sensor_ctrl_t *s_ctrl,
    uint16_t res)
{
  int32_t rc = 0;

  KC_CAM_CDBG("%s: res = %d \n",__func__,res);
  KC_CAM_CDBG("%s: mt9d113_sensor_mode = %d \n",__func__,mt9d113_sensor_mode);

  if(power_up == 0)
  {
    KC_CAM_CDBG("%s: power_up == 0 res = %d\n",__func__,res);
    KC_CAM_CDBG("%s: power_up == 0 rc = %d\n",__func__,rc);
    return rc;
  }

  msm_sensor_mt9d113_write_output_settings(s_ctrl, res);

  if(mt9d113_sensor_mode == 0)   /* SENSOR_MODE_SNAPSHOT */
  {
      mt9d113_snapshot_flg = 1;
      mt9d113_get_exp_time(s_ctrl,&mt9d113_exposure_time);
      msm_camera_i2c_write_tbl(s_ctrl->sensor_i2c_client, mt9d113_snapshot_settings,
            ARRAY_SIZE(mt9d113_snapshot_settings), MSM_CAMERA_I2C_WORD_DATA);
      msleep(200);
  }
  else if(mt9d113_sensor_mode == 2)    /* SENSOR_MODE_PREVIEW */
  {
      if(mt9d113_snapshot_flg == 1)
      {
          mt9d113_snapshot_flg = 0;
          msm_camera_i2c_write_tbl(s_ctrl->sensor_i2c_client, mt9d113_prev_settings,
                ARRAY_SIZE(mt9d113_prev_settings), MSM_CAMERA_I2C_WORD_DATA);
      }
  }
  else
  {
      KC_CAM_CDBG("%s: SENSOR_MODE_VIDEO or SENSOR_MODE_VIDEO_HD \n",__func__);
  }

  KC_CAM_CDBG("%s: end \n",__func__);

  return rc;
}

int32_t msm_sensor_mt9d113_setting(struct msm_sensor_ctrl_t *s_ctrl,
            int update_type, int res)
{
  int32_t rc = 0;
  KC_CAM_CDBG("%s: start \n",__func__);
  
  s_ctrl->func_tbl->sensor_stop_stream(s_ctrl);
  msleep(30);
  if (update_type == MSM_SENSOR_REG_INIT) 
  {
    KC_CAM_CDBG("%s: Register INIT\n",__func__);
    s_ctrl->curr_csi_params = NULL;
    msm_sensor_enable_debugfs(s_ctrl);
  }
  else if (update_type == MSM_SENSOR_UPDATE_PERIODIC) 
  {
    KC_CAM_CDBG("%s: PERIODIC : %d\n",__func__, res);
    if (s_ctrl->curr_csi_params != s_ctrl->csi_params[res]) 
    {
       s_ctrl->curr_csi_params = s_ctrl->csi_params[res];
       s_ctrl->curr_csi_params->csid_params.lane_assign =
            s_ctrl->sensordata->sensor_platform_info->
            csi_lane_params->csi_lane_assign;
       s_ctrl->curr_csi_params->csiphy_params.lane_mask =
            s_ctrl->sensordata->sensor_platform_info->
            csi_lane_params->csi_lane_mask;
       v4l2_subdev_notify(&s_ctrl->sensor_v4l2_subdev,
            NOTIFY_CSID_CFG,
            &s_ctrl->curr_csi_params->csid_params);
       mb();
       v4l2_subdev_notify(&s_ctrl->sensor_v4l2_subdev,
            NOTIFY_CSIPHY_CFG,
            &s_ctrl->curr_csi_params->csiphy_params);
       mb();
       msleep(20);
     }

     v4l2_subdev_notify(&s_ctrl->sensor_v4l2_subdev,
          NOTIFY_PCLK_CHANGE, &s_ctrl->msm_sensor_reg->
          output_settings[res].op_pixel_clk);

     mt9d113_request_res = res;
     s_ctrl->func_tbl->sensor_start_stream(s_ctrl);
     msm_sensor_mt9d113_write_res_settings(s_ctrl, res );
     power_up = 1;
     msm_sensor_mt9d113_set_white_balance(s_ctrl, mt9d113_wb_wait);
     if(ctrl_info_wait != NULL){
         mt9d113_effect_msm_sensor_s_ctrl_by_enum(s_ctrl, ctrl_info_wait, effect_value_wait);
     }
     msleep(200);
  }

  KC_CAM_CDBG("%s: end rc = %d\n",__func__,rc);
  return rc;
}

int32_t msm_sensor_mt9d113_set_sensor_mode(struct msm_sensor_ctrl_t *s_ctrl,
    int mode, int res)
{
    int32_t rc = 0;
    KC_CAM_CDBG("%s: mode = %d res = %d\n",__func__,mode,res);
    KC_CAM_CDBG("%s: s_ctrl->curr_res = %d\n",__func__,s_ctrl->curr_res);
        s_ctrl->curr_frame_length_lines =
            s_ctrl->msm_sensor_reg->
            output_settings[res].frame_length_lines;

        s_ctrl->curr_line_length_pclk =
            s_ctrl->msm_sensor_reg->
            output_settings[res].line_length_pclk;

        if (s_ctrl->is_csic ||
            !s_ctrl->sensordata->csi_if)
        {
            KC_CAM_CDBG("%s: sensor_csi_setting call\n",__func__);
            rc = s_ctrl->func_tbl->sensor_csi_setting(s_ctrl,
                 MSM_SENSOR_UPDATE_PERIODIC, res);
        }
        else
        {
            mt9d113_sensor_mode  = mode;
            KC_CAM_CDBG("%s: sensor_setting call\n",__func__);
            rc = s_ctrl->func_tbl->sensor_setting(s_ctrl,
                MSM_SENSOR_UPDATE_PERIODIC, res);
        }
        if (rc < 0)
        {
            return rc;
        }
        s_ctrl->curr_res = res;
    KC_CAM_CDBG("%s: end rc = %d\n",__func__,rc);
    return rc;
}


int32_t msm_sensor_mt9d113_power_up(struct msm_sensor_ctrl_t *s_ctrl)
{
 int32_t rc = 0;
 struct msm_camera_sensor_info *data = s_ctrl->sensordata;

 KC_CAM_CDBG("%s_IN: %d\n", __func__, __LINE__);
 s_ctrl->reg_ptr = kzalloc(sizeof(struct regulator *)
   * data->sensor_platform_info->num_vreg, GFP_KERNEL);
 if (!s_ctrl->reg_ptr) 
 {
  printk("%s: could not allocate mem for regulators\n",
   __func__);
  return -ENOMEM;
 }

 reglvs2 = regulator_get(NULL, "8921_lvs2");
 if (IS_ERR(reglvs2)) 
 {
  printk(KERN_ERR "could not get 8921_lvs2, rc = %ld\n",
   PTR_ERR(reglvs2));
  return -EINVAL;
 }

 reg_l9 = regulator_get(NULL,"8921_l9");
 if (IS_ERR(reg_l9)) 
 {
  printk(KERN_ERR "could not get 8921_l9, rc = %ld\n",
   PTR_ERR(reg_l9));
  return -EINVAL;
 }

 reg_l29 = regulator_get(NULL,"8921_l29");
 if (IS_ERR(reg_l29)) 
 {
  printk(KERN_ERR "could not get 8921_l29, rc = %ld\n",
   PTR_ERR(reg_l29));
  return -EINVAL;
 }

 if( !camera_power_on )
 {
  gpio4 = 4;
  rc = gpio_request_one(gpio4,GPIOF_DIR_IN ,"CAMIF_MCLK");
  if (rc) 
  {
   printk(KERN_ERR "request gpio 4 failed, rc=%d\n", rc);
   return -ENODEV;
  }

  gpio2 = 2;
  rc = gpio_request(gpio2, "cam_std");
  if (rc) 
  {
   printk(KERN_ERR "request gpio 2 failed, rc=%d\n", rc);
   return -ENODEV;
  }
  gpio_direction_output(gpio2, 0);
  
  gpio68 = 68;
  rc = gpio_request(gpio68, "cam_rst");
  if (rc) 
  {
   printk(KERN_ERR "request gpio 68 failed, rc=%d\n", rc);
   return -ENODEV;
  }
  gpio_direction_output(gpio68, 0);

  camera_power_on = true;
 }
 rc = regulator_set_voltage(reg_l9, 2800000, 2800000);
 if (rc) 
 {
  printk("set_voltage failed for 8921_l9, rc=%d\n", rc);
  return -EINVAL;
 }
 rc = regulator_set_voltage(reg_l29, 1800000, 1800000);
 if (rc) 
 {
  printk("set_voltage failed for 8921_l29, rc=%d\n", rc);
  return -EINVAL;
 }
 rc = regulator_set_optimum_mode(reg_l9, 100000);
 if (rc < 0) 
 {
  printk("set_voltage failed for 8921_9, rc=%d\n", rc);
  return -EINVAL;
 }
 rc = regulator_set_optimum_mode(reg_l29, 100000);
 if (rc < 0) 
 {
  printk("set_voltage failed for 8921_l29, rc=%d\n", rc);
  return -EINVAL;
 }
 gpio_set_value(68, 1);
 usleep(10);
 regulator_enable(reglvs2);
 msleep(10);
 regulator_enable(reg_l29);
 msleep(5);
 msm_cam_clk_enable(&s_ctrl->sensor_i2c_client->client->dev,
 cam_clk_info, &s_ctrl->cam_clk, ARRAY_SIZE(cam_clk_info), 1);
 usleep(10);
 gpio_set_value(68, 0);
 usleep(10);
 gpio_set_value(68, 1);
 usleep(10);
 regulator_enable(reg_l9);
 usleep(500);

 power_up = 0;
 mt9d113_snapshot_flg = 0;
 mt9d113_scene_first_set = 0;
 mt9d113_wb = MT9D113_WB_NONE;
 mt9d113_wb_wait = MT9D113_WB_NONE;
 pre_exp_setting = MT9D113_EXPOSURE_VALUE_MAX;
 effect_value = CAMERA_EFFECT_OFF;
 effect_value_wait = CAMERA_EFFECT_OFF;

 KC_CAM_CDBG("%s: %d\n", __func__, __LINE__);

 return rc;
}

int32_t msm_sensor_mt9d113_power_down(struct msm_sensor_ctrl_t *s_ctrl)
{
 int32_t rc = 0;
 KC_CAM_CDBG("%s start\n",__func__);

 gpio_set_value(2, 1);
 msleep(350);
 gpio_set_value(68, 0);
 usleep(350);
 msm_cam_clk_enable(&s_ctrl->sensor_i2c_client->client->dev,
 cam_clk_info, &s_ctrl->cam_clk, ARRAY_SIZE(cam_clk_info), 0);
 usleep(350);
 gpio_set_value(2, 0);
 regulator_disable(reg_l29);
 rc = regulator_set_optimum_mode(reg_l29, 10000);
 if (rc < 0) 
 {
  pr_err("regulator_set_optimum_mode failed for 8921_l29, rc=%d\n", rc);
  return -EINVAL;
 }
 regulator_put(reg_l29);
 usleep(50);
 regulator_disable(reg_l9);
 rc = regulator_set_optimum_mode(reg_l9, 10000);
 if (rc < 0) 
 {
  pr_err("regulator_set_optimum_mode failed for 8921_9, rc=%d\n", rc);
  return -EINVAL;
 }
 regulator_put(reg_l9);
 usleep(50);
 regulator_disable(reglvs2);
 regulator_put(reglvs2);

 KC_CAM_CDBG("%s end\n",__func__);

 return rc;
}

void msm_sensor_mt9d113_start_stream(struct msm_sensor_ctrl_t *s_ctrl)
{
 KC_CAM_CDBG("%s start\n",__func__);

 if(power_up == 1)
 {
   msm_sensor_start_stream(s_ctrl);

   KC_CAM_CDBG("%s power_up =%d\n",__func__,power_up);
 }
 else
 {
   msm_sensor_write_all_conf_array(
      s_ctrl->sensor_i2c_client,
      s_ctrl->msm_sensor_reg->init_settings,
      s_ctrl->msm_sensor_reg->init_size);

   msm_sensor_mt9d113_write_output_settings(s_ctrl, mt9d113_request_res);
 }
 
 mt9d113_skip_frame_flg = 0;

 mt9d113_power_on_flg = 1;
 mt9d113_err_chk_work->s_ctrl = s_ctrl;
 queue_work( mt9d113_err_chk_wq, (struct work_struct *)mt9d113_err_chk_work );

 KC_CAM_CDBG("%s end\n",__func__);
}

void msm_sensor_mt9d113_stop_stream(struct msm_sensor_ctrl_t *s_ctrl)
{
 KC_CAM_CDBG("%s start\n",__func__);

 mt9d113_power_on_flg = 0;

 msm_sensor_stop_stream(s_ctrl);

 KC_CAM_CDBG("%s end\n",__func__);
}

int32_t msm_sensor_mt9d113_write_exp(struct msm_sensor_ctrl_t *s_ctrl, int8_t exp_value)
{
 int32_t exp_setting;
 int32_t rc = 0;

 if(power_up == 0)
 {
    KC_CAM_CDBG("%s: power_up == 0  rc = %d\n", __func__, rc);
    return rc;
 }

  exp_setting = exp_value / MT9D113_EXPOSURE_VALUE_STEP + MT9D113_EXPOSURE_VALUE_MAX;
  if (exp_setting < 0) 
  {
      exp_setting = 0;
  }
  else if (exp_setting > (MT9D113_EXPOSURE_VALUE_MAX * 2)) 
  {
      exp_setting = MT9D113_EXPOSURE_VALUE_MAX * 2;
  }

  KC_CAM_CDBG("%s: exp_value = %d, exp_setting = %d\n", __func__, exp_value, exp_setting);

  if (pre_exp_setting == exp_setting) 
  {
      KC_CAM_CDBG("%s: exp_setting no change \n", __func__);
      return 0;
  }
  pre_exp_setting = exp_setting;

  rc = msm_camera_i2c_write_tbl(
      s_ctrl->sensor_i2c_client,
      &mt9d113_config_exposure_settings[exp_setting][0],
      ARRAY_SIZE(mt9d113_config_exposure_settings[exp_setting]),
      s_ctrl->msm_sensor_reg->default_data_type);
  if (rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  msm_sensor_mt9d113_set_skip_frame();

 KC_CAM_CDBG("%s: rc = %d\n", __func__, rc);
 return rc;
}

int32_t msm_sensor_mt9d113_set_white_balance(struct msm_sensor_ctrl_t *s_ctrl, int8_t wb)
{
  int32_t index = 0;
  int32_t rc = 0;

  KC_CAM_CDBG("%s: wb = %d\n", __func__, wb);

  mt9d113_wb_wait = wb;

  if(power_up == 0)
  {
     KC_CAM_CDBG("%s: power_up == 0  rc = %d\n", __func__, rc);
     return 0;
  }

  if (mt9d113_wb == wb) 
  {
     KC_CAM_CDBG("%s: wb no change \n", __func__);
     return 0;
  }

  mt9d113_wb = wb;

  switch (wb) 
  {
    case CAMERA_WB_DAYLIGHT:
        index = MT9D113_WB_DAYLIGHT;
    break;

    case CAMERA_WB_FLUORESCENT:
        index = MT9D113_WB_FLUORESCENT;
    break;

    case CAMERA_WB_CLOUDY_DAYLIGHT:
        index = MT9D113_WB_CLOUDY_DAYLIGHT;
    break;

    case CAMERA_WB_INCANDESCENT:
        index = MT9D113_WB_INCANDESCENT;
    break;

    case CAMERA_WB_AUTO:
    default:
        index = MT9D113_WB_AUTO;
    break;
  }

  rc = msm_camera_i2c_write_tbl(
    s_ctrl->sensor_i2c_client,
    &mt9d113_config_white_balance_settings[index][0],
    ARRAY_SIZE(mt9d113_config_white_balance_settings[index]),
    s_ctrl->msm_sensor_reg->default_data_type);
  if (rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  msm_sensor_mt9d113_set_skip_frame();

  KC_CAM_CDBG("%s: rc = %d\n", __func__, rc);
  return rc;
}

static void msm_sensor_mt9d113_set_scene_work(struct work_struct *work)
{
    int32_t index = 0;
    int32_t i2c_rc = 0;
    uint16_t read_data = 0;
    uint16_t read_bit8 = 0;
    uint16_t read_bit7 = 0;
    uint16_t read_bit06 = 0;
    uint16_t read_green1_gain = 0;
    uint16_t read_ae_current_y = 0;
    static bool mt9d113_set_scene_flg = TRUE;

    mt9d113_work_t *tmp_work = (mt9d113_work_t *)work;
    struct msm_sensor_ctrl_t *s_ctrl = tmp_work->s_ctrl;

    KC_CAM_CDBG("%s: E\n", __func__);

    if (mt9d113_wb != CAMERA_WB_AUTO) 
    {
        KC_CAM_CDBG("%s: wb not AUTO\n", __func__);
        return;
    }

    mutex_lock(s_ctrl->msm_sensor_mutex);

    if (!mt9d113_set_scene_flg) 
    {
        mt9d113_set_scene_flg = TRUE;
        KC_CAM_CDBG("%s: SKIP\n", __func__);

        mutex_unlock(s_ctrl->msm_sensor_mutex);

        return;
    }
    else 
    {
        mt9d113_set_scene_flg = FALSE;
    }

  i2c_rc = msm_camera_i2c_read(
      s_ctrl->sensor_i2c_client,
      0x3056,
      &read_data,
      s_ctrl->msm_sensor_reg->default_data_type);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  KC_CAM_CDBG("[scene]read_data:0x%04x\n", read_data);

  read_bit8  = (read_data & 0x0100) >> 8;
  read_bit7  = (read_data & 0x0080) >> 7;
  read_bit06 = (read_data & 0x007f);

  KC_CAM_CDBG("[scene]read_bit8:%d read_bit7:%d read_bit06:0x%04x\n", read_bit8,read_bit7,read_bit06);

  read_green1_gain  = (read_bit8+1)*(read_bit7+1)*read_bit06*100/0x0020;

  KC_CAM_CDBG("[scene]read_green1_gain:%d\n", read_green1_gain);
  i2c_rc = msm_camera_i2c_write(
      s_ctrl->sensor_i2c_client,
      0x098C, 0xA218,
      MSM_CAMERA_I2C_WORD_DATA);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  i2c_rc = msm_camera_i2c_read(
      s_ctrl->sensor_i2c_client,
      0x0990,
      &read_ae_current_y,
      s_ctrl->msm_sensor_reg->default_data_type);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  KC_CAM_CDBG("[scene]read_ae_current_y:0x%x\n", read_ae_current_y);

  if(read_green1_gain <= 125 && read_ae_current_y >= 0x003C)
  {
    index = 1; /* daylight (outdoor) */
  }
  else
  {
    index = 0; /* auto (indoor) */
  }

    if(mt9d113_scene_first_set == 1)
    {
        if(mt9d113_scene_index == index)
        {
             KC_CAM_CDBG("%s: scene no change \n", __func__);
             goto exit;
        }
    }

    mt9d113_scene_index = index;

    KC_CAM_CDBG("%s: mt9d113_scene_index = %x, index = %x mt9d113_scene_first_set = %x\n",
                 __func__, mt9d113_scene_index, index,mt9d113_scene_first_set);

    i2c_rc = msm_camera_i2c_write_tbl(
        s_ctrl->sensor_i2c_client,
        &mt9d113_scene_settings[mt9d113_scene_index][0],
        ARRAY_SIZE(mt9d113_scene_settings[mt9d113_scene_index]),
        s_ctrl->msm_sensor_reg->default_data_type);
    if (i2c_rc < 0) 
    {
        pr_err("%s: scene set err \n", __func__);
        msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
        goto failure;
    }

    mt9d113_scene_first_set = 1;

exit:
failure:

    mutex_unlock(s_ctrl->msm_sensor_mutex);
    KC_CAM_CDBG("%s: X i2c_rc = %d\n", __func__, i2c_rc);
}

int32_t msm_sensor_mt9d113_set_scene(struct msm_sensor_ctrl_t *s_ctrl)
{
    int32_t rc = 0;

    mt9d113_work->s_ctrl = s_ctrl;
    KC_CAM_CDBG("%s: start \n",__func__);
    queue_work( mt9d113_wq, (struct work_struct *)mt9d113_work );
    KC_CAM_CDBG("%s: end \n",__func__);

    return rc;
}


static int32_t msm_sensor_mt9d113_set_note_takepic(struct msm_sensor_ctrl_t *s_ctrl)
{
    int32_t rc = 0;

    uint32_t line_length_pck         = 0x00000000;
    uint32_t corse_integration_time  = 0x00000000;
    uint32_t fine_integration_time   = 0x00000000;
    uint32_t vt_pix_clk_freq_mhz     = 0x00000000;
    uint16_t r_data;

    uint16_t pll_divider    = 0x0000;
    uint16_t pll_p_divider  = 0x0000;

    uint16_t pll_divider_m  = 0x0000;
    uint16_t pll_divider_n  = 0x0000;
    uint16_t pll_divider_p1 = 0x0000;

    KC_CAM_CDBG("%s: start \n",__func__);

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x0010,
          &pll_divider,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        goto failure;
    }

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x0012,
          &pll_p_divider,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        goto failure;
    }

    KC_CAM_CDBG("EXIF1:0x%04x,0x%04x\n", pll_divider, pll_p_divider);

    /* Calculation of "vt_pix_clk_freq_mhz" */
    pll_divider_m  = pll_divider & 0x00FF;
    pll_divider_n  = (pll_divider & 0x3F00) >> 8;
    pll_divider_p1 = pll_p_divider & 0x000F;
    vt_pix_clk_freq_mhz = (uint32_t)( (24*pll_divider_m)/((pll_divider_n+1)*(pll_divider_p1+1)) );

    KC_CAM_CDBG("EXIF2:0x%04x\n", vt_pix_clk_freq_mhz);

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x300C,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        goto failure;
    }
    line_length_pck = (uint32_t)r_data;

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x3012,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        goto failure;
    }
    corse_integration_time = (uint32_t)r_data;

    rc = msm_camera_i2c_read(
          s_ctrl->sensor_i2c_client,
          0x3014,
          &r_data,
          s_ctrl->msm_sensor_reg->default_data_type);
    if (rc < 0) 
    {
        pr_err("%s: i2c read err \n", __func__);
        goto failure;
    }
    fine_integration_time = (uint32_t)r_data;

    KC_CAM_CDBG("%s: line_length_pck=%x corse_integration_time=%x fine_integration_time=%x \n",
                __func__,line_length_pck,corse_integration_time,fine_integration_time);

    /* ms */
    mt9d113_exposure_time = ((corse_integration_time * line_length_pck) + fine_integration_time) / (vt_pix_clk_freq_mhz * 1000);

    KC_CAM_CDBG("%s: time[ms]=%d \n",__func__,mt9d113_exposure_time);

failure:
    return rc;
    KC_CAM_CDBG("%s: end \n",__func__);
}




static void msm_sensor_mt9d113_error_check_work(struct work_struct *work)
{
    int32_t i2c_rc = 0;
    uint16_t read_data;
    mt9d113_work_t *tmp_work = (mt9d113_work_t *)work;
    struct msm_sensor_ctrl_t *s_ctrl = tmp_work->s_ctrl;

    KC_CAM_CDBG("%s: E\n", __func__);

    while (mt9d113_power_on_flg) 
    {
        KC_CAM_CDBG("%s: loop \n", __func__);

        mutex_lock(s_ctrl->msm_sensor_mutex);

        i2c_rc = msm_camera_i2c_read(
            s_ctrl->sensor_i2c_client,
            MT9D113_REG_READ_ADDR,
            &read_data,
            s_ctrl->msm_sensor_reg->default_data_type);

        if (i2c_rc < 0) 
        {
            pr_err("%s: X i2c_rc = %d\n", __func__, i2c_rc);
            msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
            return;
        }

        KC_CAM_CDBG("%s: read_data = %x \n", __func__, read_data);
        if (read_data != MT9D113_ERR_CHK_VAL) 
        {
            pr_err("%s: X read_data = %d\n", __func__, read_data);
            msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
            return;
        }
        else 
        {
            KC_CAM_CDBG("%s: OK\n", __func__);
        }

        mutex_unlock(s_ctrl->msm_sensor_mutex);

        msleep(2000);
    }

    KC_CAM_CDBG("%s: X\n", __func__);
    return;
}

static void msm_sensor_mt9d113_set_skip_frame(void) 
{
    KC_CAM_CDBG("%s: E\n", __func__);
    mt9d113_skip_frame_flg = 1;
}

static void msm_sensor_mt9d113_get_frame_skip_flg(struct msm_sensor_ctrl_t *s_ctrl, uint8_t *flag)
{
    KC_CAM_CDBG("%s: E\n", __func__);
    *flag = mt9d113_skip_frame_flg;
    mt9d113_skip_frame_flg = 0;
}

static int32_t msm_sensor_mt9d113_get_is_flash(struct msm_sensor_ctrl_t *s_ctrl, uint8_t *is_flash)
{
  int32_t i2c_rc = 0;
  uint16_t read_data = 0;
  uint16_t read_bit8 = 0;
  uint16_t read_bit7 = 0;
  uint16_t read_bit06 = 0;
  uint16_t read_green1_gain = 0;
  uint16_t read_ae_current_y = 0;

  KC_CAM_CDBG("%s: E\n", __func__);

  i2c_rc = msm_camera_i2c_read(
      s_ctrl->sensor_i2c_client,
      0x3056,
      &read_data,
      s_ctrl->msm_sensor_reg->default_data_type);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  KC_CAM_CDBG("read_data:%d\n", read_data);

  read_bit8  = (read_data & 0x0100) >> 8;
  read_bit7  = (read_data & 0x0080) >> 7;
  read_bit06 = (read_data & 0x007f);

  KC_CAM_CDBG("read_bit8:%d read_bit7:%d read_bit06:%d\n", read_bit8,read_bit7,read_bit06);

  read_green1_gain  = (read_bit8+1)*(read_bit7+1)*read_bit06*10/0x0020;

  KC_CAM_CDBG("read_green1_gain:%d\n", read_green1_gain);

  i2c_rc = msm_camera_i2c_write(
      s_ctrl->sensor_i2c_client,
      0x098C, 0xA218,
      MSM_CAMERA_I2C_WORD_DATA);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  i2c_rc = msm_camera_i2c_read(
      s_ctrl->sensor_i2c_client,
      0x0990,
      &read_ae_current_y,
      s_ctrl->msm_sensor_reg->default_data_type);
  if (i2c_rc < 0) 
  {
      pr_err("%s: i2c write err \n", __func__);
      msm_sensor_evt_notify(s_ctrl, MSG_ID_ERROR_I2C);
  }

  KC_CAM_CDBG("read_ae_current_y:0x%x\n", read_ae_current_y);

  if(read_green1_gain >= 0x0053 && read_ae_current_y <= 0x0024)
  {
    *is_flash = 1;
  }
  else
  {
    *is_flash = 0;
  }

  KC_CAM_CDBG("%s: X flash %d \n", __func__, *is_flash);
  return 0;
}


static const struct i2c_device_id mt9d113_i2c_id[] = {
 {SENSOR_NAME, (kernel_ulong_t)&mt9d113_s_ctrl},
 { }
};

static struct i2c_driver mt9d113_i2c_driver = {
 .id_table = mt9d113_i2c_id,
 .probe  = msm_sensor_i2c_probe,
 .driver = {
  .name = SENSOR_NAME,
 },
};

static struct msm_camera_i2c_client mt9d113_sensor_i2c_client = {
 .addr_type = MSM_CAMERA_I2C_WORD_ADDR,
};

static int __init msm_sensor_init_module(void)
{
    mt9d113_wq = create_workqueue("mt9d113_queue");
    if (mt9d113_wq) 
    {
        mt9d113_work = (mt9d113_work_t *)kmalloc(sizeof(mt9d113_work_t), GFP_KERNEL);
        if (mt9d113_work) 
        {
            INIT_WORK( (struct work_struct *)mt9d113_work, msm_sensor_mt9d113_set_scene_work );
        }
    }

    mt9d113_err_chk_wq = create_workqueue("mt9d113_err_chk_queue");
    if (mt9d113_err_chk_wq) 
    {
        mt9d113_err_chk_work = (mt9d113_work_t *)kmalloc(sizeof(mt9d113_work_t), GFP_KERNEL);
        if (mt9d113_err_chk_work) 
        {
            INIT_WORK( (struct work_struct *)mt9d113_err_chk_work, msm_sensor_mt9d113_error_check_work );
        }
    }
    return i2c_add_driver(&mt9d113_i2c_driver);
}

static struct v4l2_subdev_core_ops mt9d113_subdev_core_ops = {
 .s_ctrl = msm_sensor_v4l2_s_ctrl,
 .queryctrl = msm_sensor_v4l2_query_ctrl,
 .ioctl = msm_sensor_subdev_ioctl,
 .s_power = msm_sensor_power,
};

static struct v4l2_subdev_video_ops mt9d113_subdev_video_ops = {
 .enum_mbus_fmt = msm_sensor_v4l2_enum_fmt,
};

static struct v4l2_subdev_ops mt9d113_subdev_ops = {
 .core = &mt9d113_subdev_core_ops,
 .video  = &mt9d113_subdev_video_ops,
};

static struct msm_sensor_fn_t mt9d113_func_tbl = {
 .sensor_start_stream = msm_sensor_mt9d113_start_stream,
 .sensor_stop_stream = msm_sensor_mt9d113_stop_stream,
 .sensor_setting = msm_sensor_mt9d113_setting,
 .sensor_set_sensor_mode = msm_sensor_mt9d113_set_sensor_mode,
 .sensor_mode_init = msm_sensor_mode_init,
 .sensor_get_output_info = msm_sensor_get_output_info,
 .sensor_config = msm_sensor_config,
 .sensor_power_up = msm_sensor_mt9d113_power_up,
 .sensor_power_down = msm_sensor_mt9d113_power_down,
  .sensor_set_exposure_compensation = msm_sensor_mt9d113_write_exp,
  .sensor_set_white_balance = msm_sensor_mt9d113_set_white_balance,
  .sensor_set_vfe_msg_out = msm_sensor_mt9d113_set_scene,
  .sensor_get_exposure_time = msm_sensor_mt9d113_get_exp_time,
 .sensor_set_note_takepic = msm_sensor_mt9d113_set_note_takepic,
 .sensor_get_csi_params = msm_sensor_get_csi_params,
 .sensor_get_frame_skip_flg = msm_sensor_mt9d113_get_frame_skip_flg,
 .sensor_get_is_flash = msm_sensor_mt9d113_get_is_flash,
};

static struct msm_sensor_reg_t mt9d113_regs = {
  .default_data_type = MSM_CAMERA_I2C_WORD_DATA, /* add special */
  .start_stream_conf = mt9d113_start_stream_settings,
  .start_stream_conf_size = ARRAY_SIZE(mt9d113_start_stream_settings),
  .stop_stream_conf = mt9d113_stop_stream_settings,
  .stop_stream_conf_size = ARRAY_SIZE(mt9d113_stop_stream_settings),
  .init_settings = &mt9d113_init_conf[0],
  .init_size = ARRAY_SIZE(mt9d113_init_conf),
  .output_settings = &mt9d113_dimensions[0],
  .num_conf = ARRAY_SIZE(mt9d113_dimensions),
};

static struct msm_sensor_ctrl_t mt9d113_s_ctrl = {
 .msm_sensor_reg = &mt9d113_regs,
 .msm_sensor_v4l2_ctrl_info = mt9d113_v4l2_ctrl_info,
 .num_v4l2_ctrl = ARRAY_SIZE(mt9d113_v4l2_ctrl_info),
 .sensor_i2c_client = &mt9d113_sensor_i2c_client,
 .sensor_i2c_addr = 0x7A,
 .sensor_output_reg_addr = &mt9d113_reg_addr,
 .sensor_id_info = &mt9d113_id_info,
 .cam_mode = MSM_SENSOR_MODE_INVALID,
 .csi_params = &mt9d113_csi_params_array[0],
 .msm_sensor_mutex = &mt9d113_mut,
 .sensor_i2c_driver = &mt9d113_i2c_driver,
 .sensor_v4l2_subdev_info = mt9d113_subdev_info,
 .sensor_v4l2_subdev_info_size = ARRAY_SIZE(mt9d113_subdev_info),
 .sensor_v4l2_subdev_ops = &mt9d113_subdev_ops,
 .func_tbl = &mt9d113_func_tbl,
};

module_init(msm_sensor_init_module);
MODULE_DESCRIPTION("Aptina 2MP YUV sensor driver");
MODULE_LICENSE("GPL v2");
